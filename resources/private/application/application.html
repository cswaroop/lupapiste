<!DOCTYPE html>
<html>
    <body>
        <section class="page" id="application">
            <div class="application_summary">
              <div class="container">
                <div class="preamble"
                     data-bind="visible: lupapisteApp.services.cardService.showCard( 'summary', 'info', true )">
                        <div class="application_summary_info" data-bind="with: application">
                          <h1 data-bind="component: {name: 'address',
                                         params: { application: $parent,
                                                   edit: 'edit'}}"></h1> <!-- TODO implement LPK-724 and change: edit: 'edit.address' -->
                          <h2 data-bind="if: primaryOperation">
                                <span data-test-id="test-application-primary-operation"
                                      data-bind="ltext: primaryOperationName, attr: {'data-test-primary-operation-id': primaryOperation().name}"></span>
                                <span data-bind="visible: permitSubtype() === 'muutoslupa',
                                                 ltext: 'permitSubtype.muutoslupa'"
                                      class="modification-permit"></span>
                            </h2>

                            <!-- State: -->
                            <div class="state-indication" data-bind="attr: {'data-test-state': state}" data-test-id="application-state" >
                                <div data-bind="attr: {'class': state}">
                                  <!-- ko ifnot: currentStateInSeq() -->
                                  <span data-bind="ltext: state, attr: {'title' : loc([state(), 'title']), 'class': state() + '-box'}"></span>
                                  <!-- /ko -->
                                  <!-- ko  foreach: stateSeq -->
                                  <span data-bind="ltext: $data,
                                                   attr: {
                                                    'title': $root.application.isArchivingProject() ? loc([$data, 'archivingProject', 'title']) : loc([$data, 'title']),
                                                    'class': $data + '-box'
                                                   }">
                                  </span>
                                  <!-- /ko -->
                                </div>
                            </div>
                            <div data-bind="if: $root.application.state() == 'draft'" class="summary-help">
                                <p data-bind="lhtml: 'application.state.draft.help'"></p>
                            </div>
                            <div data-bind="if: hasInvites" class="summary-help">
                                <p data-bind="lhtml: 'application.invite.help'"></p>
                            </div>
                            <div data-bind="template: { name: 'application-summary-table-template' }"></div>
                        </div>
                        <div class="application-map-container">
                          <div id="application-map" class="map map-large" style="width: 320px; height: 280px;"></div>
                          <div class="application-map-actions" data-bind="with: application">
                            <!-- ko if: location() -->
                            <button data-bind="click: openOskariMap,
                                               ltext:'map.open'"
                                    class="function" ></button>
                            <open-3d-map></open-3d-map>
                            <!-- /ko -->
                          </div>
                        </div>

                        <!-- Actions: -->
                        <div class="application_actions" data-bind="if: lupapisteApp.models.rootVMO.currentPage() === 'application'">
                            <div data-bind="template: 'application-actions-template'"></div>
                        </div>
                </div>
                <card params="deck: 'summary',
                              card: 'edit-handlers'">
                          <edit-handlers></edit-handlers>
                </card>
                <card params="deck: 'summary',
                              card: 'add-link-permit'">
                  <add-link-permit></add-link-permit>
                </card>
                    <!-- Tabs: -->
                    <div class="tabs-container"
                         data-bind="with: application,
                                    visible: lupapisteApp.services.cardService.showCard( 'summary', 'info')">
                        <ul class="tabs" id="applicationTabs">
                            <li data-bind="if: $root.authorization.ok('application-info-tab-visible'), css: {'active': $parent.selectedTabName() === 'info'}">
                                <a data-bind="click: changeTab" href="#" data-target="info" data-test-id="application-open-info-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabInfo', visible: !$root.application.isArchivingProject()"></span>
                                    <span data-bind="ltext: 'application.archivingProject.tabInfo', visible: $root.application.isArchivingProject()"></span>
                                    <span data-bind="if: nonpartyDocumentIndicator">
                                        <span data-bind="text: nonpartyDocumentIndicator" id="applicationNonpartyDocumentIndicator" class="indicator"></span>
                                    </span></a></li>
                            <li data-bind="css: {'active': $parent.selectedTabName() === 'parties'}">
                                <a data-bind="click: changeTab" href="#" data-target="parties" data-test-id="application-open-parties-tab" class="link-btn">

                                    <span data-bind="ltext: titleForPartiesOrSupervisor"></span>

                                    <span data-bind="if: partyDocumentIndicator">
                                        <span data-bind="text: partyDocumentIndicator" id="applicationPartyDocumentIndicator" class="indicator"></span></span></a></li>
                            <li data-bind="if: $root.authorization.ok('tasks-tab-visible'), css: {'active': $parent.selectedTabName() === 'tasks'}">
                                <a data-bind="click: changeTab, css: tasksButtonClass" href="#" data-target="tasks" data-test-id="application-open-tasks-tab" class="link-btn">
                                    <!-- ko if: $root.authorization.ok('ya-application') -->
                                    <span data-bind="ltext: 'application.tabConstructionTimeTasksYA'"></span>
                                    <!-- /ko -->
                                    <!-- ko if: !$root.authorization.ok('ya-application') -->
                                    <span data-bind="ltext: 'application.tabConstructionTimeTasks'"></span>
                                    <!-- /ko -->
                                    <span data-bind="if: $data.tasksRequiringAction">
                                        <span data-bind="text: tasksRequiringAction" id="applicationTasksRequiringAction" class="indicator"></span></span></a></li>

                            <li data-bind="css: {'active': $parent.selectedTabName() === 'attachments'}">
                                <a data-bind="click: changeTab" href="#" data-target="attachments" data-test-id="application-open-attachments-tab" class="link-btn">
                                    <span data-bind="ltext: 'application.tabAttachments'"></span>
                                    <span data-bind="if: attachmentsRequiringAction">
                                        <span data-bind="text: attachmentsRequiringAction" id="applicationAttachmentsRequiringAction" class="indicator"></span></span></a></li>

                            <li data-bind="if: requiredFieldSummaryButtonVisible,
                                           css: {'active': $parent.selectedTabName() === 'requiredFieldSummary'}">
                                <a data-bind="click: changeTab, css: requiredFieldSummaryButtonClass" href="#"
                                   data-target="requiredFieldSummary" data-test-id="application-open-requiredFieldSummary-tab">
                                  <span data-bind="ltext: requiredFieldSummaryButtonKey"></span>
                                </a>
                            </li>

                            <li data-bind="if: $root.authorization.ok('application-statement-tab-visible'), css: {'active': $parent.selectedTabName() === 'statement'}">
                                <a data-bind="click: changeTab" href="#" data-target="statement" data-test-id="application-open-statement-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.tabStatement'"></span>
                                    <span data-bind="if: unseenStatements">
                                        <span data-bind="text: unseenStatements" id="applicationUnseenStatements" class="indicator"></span></span></a></li>

                            <li data-bind="ifnot: _.includes(['draft', 'open'], state()) || !$root.authorization.ok( 'application-verdict-tab-visible'),
                                           css: {'active': $parent.selectedTabName() === 'verdict'}">
                              <a data-bind="click: changeTab" href="#" data-target="verdict" data-test-id="application-open-verdict-tab"
                                 class="link-btn">
                                <span data-bind="ltext: 'application.tabVerdict' + $root.application.verdictPostfix()"></span>
                                <span data-bind="if: unseenVerdicts">
                                      <span data-bind="text: unseenVerdicts" id="applicationUnseenVerdists" class="indicator"></span></span></a></li>

                            <li data-bind="if: $root.authorization.ok( 'pate-verdict-tab')">
                              <a  data-bind="click: changeTab,
                                             feature: 'pate'"
                                  href="#" data-target="pate-verdict" data-test-id="pate-verdict-tab"
                                  class="link-btn">
                                <span data-bind="ltext: 'application.tabVerdict' + $root.application.verdictPostfix()"></span>
                              </a>
                            </li>

                            <!-- In post-verdict states plus 'canceled' -->
                            <li data-bind="if: $root.authorization.ok('application-summary-tab-visible'), css: {'active': $parent.selectedTabName() === 'applicationSummary'}">
                                <a data-bind="click: changeTab" href="#" data-target="applicationSummary" data-test-id="application-open-applicationSummary-tab"
                                   class="link-btn">
                                    <span data-bind="ltext: 'application.applicationSummary', visible: !$root.application.isArchivingProject()"></span>
                                    <span data-bind="ltext: 'application.archivingProject.tabInfo', visible: $root.application.isArchivingProject()"></span>
                                </a></li>

                            <!-- Can be shown if calendars are active in the target municipality and sector -->
                            <li data-bind="if: $root.calendarConfig.initialized, css: {'active': $parent.selectedTabName() === 'calendar'}">
                              <a data-bind="click: changeTab" href="#" data-target="calendar" data-test-id="application-open-calendar-tab" class="link-btn">
                                <span data-bind="ltext: 'application.tabCalendar'"></span>
                                <span data-bind="if: calendarNotificationIndicator">
                                  <span data-bind="text: calendarNotificationIndicator" id="applicationCalendarNotificationIndicator" class="indicator"></span>
                                </span>
                              </a>
                            </li>

                            <li data-bind="if: $root.authorization.ok('archiving-operations-enabled'),
                                           css: {'active': $parent.selectedTabName() === 'archival'}">
                                <a data-bind="click: changeTab" href="#" data-target="archival" data-test-id="application-open-archival-tab" class="link-btn">
                                    <span data-bind="ltext: 'arkistointi'"></span>
                                </a></li>

                            <li data-bind="if: tosFunction() && $root.authorization.ok('permanent-archive-enabled') && $root.authorization.ok('case-file-data'),
                                             css: {'active': $parent.selectedTabName() === 'caseFile'}">
                              <a data-bind="click: changeTab" href="#" data-target="caseFile" data-test-id="application-open-caseFile-tab" class="link-btn">
                                <span data-bind="ltext: 'caseFile.tab'"></span>
                              </a></li>

                            <li data-bind="if: !_.isEmpty($root.application.id()) && $root.authorization.ok('inspection-summaries-for-application'),
                                           css: {'active': $parent.selectedTabName() === 'inspectionSummaries'}">
                              <a data-bind="click: changeTab" href="#" data-target="inspectionSummaries" data-test-id="application-open-inspectionSummaries-tab" class="link-btn">
                                <span data-bind="ltext: 'inspectionSummaries.tab'"></span>
                              </a>
                            </li>

                            <li data-bind="if: $root.authorization.ok('bulletin-for-application-verdict-enabled'),
                                             css: {'active': $parent.selectedTabName() === 'bulletin'}">
                              <a data-bind="click: changeTab" href="#" data-target="bulletin" data-test-id="application-open-bulletin-tab" class="link-btn">
                                <span data-bind="ltext: 'bulletin'"></span>
                              </a>
                            </li>

                            <li data-bind="if: $root.authorization.ok('ymp-publish-bulletin-enabled'),
                                           css: {'active': $parent.selectedTabName() === 'ymp-bulletin'}">
                              <a data-bind="click: changeTab" href="#" data-target="ymp-bulletin" data-test-id="application-open-ymp-bulletin-tab" class="link-btn">
                                <span data-bind="ltext: 'bulletin'"></span>
                              </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="container"
                 data-bind="visible: lupapisteApp.services.cardService.showCard( 'summary', 'info')">
                <div class="tab-content-container content">

                    <!-- Application info tab -->

                    <div id="application-info-tab" class="tab-content" data-bind="with: application">
                        <div>
                            <h1 data-bind="ltext: 'application.tabInfo', visible: !$root.application.isArchivingProject()"></h1>
                            <h1 data-bind="ltext: 'application.archivingProject.tabInfo', visible: $root.application.isArchivingProject()"></h1>
                            <span data-bind="component: {
                                             name: 'help-toggle',
                                             params: {lhtml: 'help.' + permitType() + '.applicationInfoDesc' }
                                             }"></span>
                        </div>
                        <!-- ko if: $parent.selectedTabName() === 'info' && $root.authorization.ok("create-assignment") -->
                        <create-assignment data-test-id="create-assignment-component"
                                           params="authorities: $root.authorities,
                                                   applicationId: id,
                                                   initialTarget: 'documents',
                                                   targets: lupapisteApp.services.assignmentService.targets"></create-assignment>
                        <!-- /ko -->
                        <div data-bind="if: $root.application.state() == 'draft'">
                            <p data-bind="lhtml: 'application.state.draft.help'"></p>
                        </div>

                        <!-- ko if: $root.application.isArchivingProject -->
                        <backend-id-manager params="verdicts: $root.verdictModel.unfilteredVerdicts,
                                                    applicationId: $root.application.id,
                                                    authModel: $root.authorization"></backend-id-manager>
                        <!-- /ko -->

                        <div class="operation-info">
                            <!-- ko if: !$root.authorization.ok('link-permit-required') && permitType() -->
                            <div class="margins-m no-top" data-bind="if: $root.authorization.ok('add-operation')">
                              <div class="help-box">
                                <p data-bind="lhtml: 'help.' + permitType() + '.AddOperations'"></p>
                                <button data-bind="click: addOperation, enable: $root.authorization.ok('add-operation')" class="positive">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addOperation'"></span>
                                </button>
                              </div>
                            </div>
                            <!-- /ko -->
                            <div data-bind="if: $root.authorization.ok('link-permit-required')">
                              <div class="help-box margins-m">
                                <p data-bind="ltext: 'help.AddPermit'"></p>
                                <button data-bind="click: $root.application.gotoLinkPermitCard,
                                                   testId: 'add-required-link-permit',
                                                   enable: $root.authorization.ok('link-permit-required'),
                                                   visible: $root.authorization.ok('add-link-permit')"
                                        class="positive">
                                    <i class="lupicon-circle-plus"></i>
                                    <span data-bind="ltext: 'application.addLinkPermit'"></span>
                                </button>
                              </div>
                            </div>
                        </div>
                        <p class="top-marginM" data-bind="lhtml: 'required.field.desc'"></p>
                        <!-- docgen generated content: -->
                        <div class="application_section">
                           <div id="applicationDocgen" class="docgen-content">
                                <!-- This is where generated document will be placed. -->
                            </div>
                        </div>

                        <div class="process-nav">
                            <a class="btn primary process-next" data-bind="click: $root.application.nextTab" href="#" data-target="parties">
                                <span data-bind="ltext: 'application.next-tab'"></span>
                                <i class="lupicon-chevron-right"></i>
                            </a>
                        </div>
                    </div>

                    <!-- Parties tab -->

                    <div data-bind="template: 'parties-tab-template'"></div>

                    <!-- Attachments tab -->

                    <!-- ko if: selectedTabName() === 'attachments' && $root.authorization.ok( "attachments" ) -->
                    <div id="application-attachments-tab" class="tab-content">
                      <drop-zone></drop-zone>
                      <attachments-listing/>
                    </div>
                    <!-- /ko -->

                    <!-- Required field summary tab -->

                    <!-- ko if: selectedTabName() === 'requiredFieldSummary' -->
                    <div data-bind="template: 'required-fields-summary-tab-template'"></div>
                    <!-- /ko -->


                    <!-- Application summary tab -->

                    <div id="application-applicationSummary-tab" data-bind="with: $root.application" class="tab-content" >

                        <h1 data-bind="ltext: 'application.tabApplicationSummary', visible: !$root.application.isArchivingProject()"></h1>
                        <h1 data-bind="ltext: 'application.archivingProject.tabInfo', visible: $root.application.isArchivingProject()"></h1>
                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.application.summary'}
                                         }"></span>

                        <div data-bind="if: $root.application.isArchivingProject" style="margin-bottom: 2em;">
                        <backend-id-manager params="verdicts: $root.verdictModel.unfilteredVerdicts,
                                                      applicationId: $root.application.id,
                                                      authModel: $root.authorization"></backend-id-manager>
                        </div>

                        <div class="application_section">
                            <div id="applicationAndPartiesDocgen" class="docgen-content">
                                <!-- This is where the generated documents will be placed. -->
                            </div>
                        </div>

                        <!-- ko ifnot: $root.application.isArchivingProject -->
                        <section class="accordion" id="accordion-application-summary-statements">
                            <button onclick="accordion.click(this)"
                                    data-test-id="accordion-application-summary-statements-header"
                                    class="secondary accordion-toggle"
                                    data-bind="css: { toggled: lupapisteApp.models.applicationAuthModel.ok('enable-accordions')}">
                                <i class="lupicon-chevron-down"></i>
                                <i class="lupicon-chevron-up toggle"></i>
                                <span class="bar-text" data-bind="ltext: 'application.statements'" style="margin-right: 0">Lausunnot</span>
                            </button>
                            <div class="accordion_content"
                                 data-bind="
                                        attr: {'data-accordion-state': lupapisteApp.models.applicationAuthModel.ok('enable-accordions') ? 'open' : 'closed'},
                                        css: { expanded: lupapisteApp.models.applicationAuthModel.ok('enable-accordions')}
                                        ">
                                <div class="accordion-fields">
                                    <div id="application-summary-statements-table" data-bind="if: summaryAvailable">
                                      <div data-bind="component: {name: 'statements-table',
                                                                  params: {application: $data,
                                                                           statements: $data.statements,
                                                                           authModel: $root.authorization,
                                                                           localisationKeys: {missing: 'application.statement.missing-from-prev-permit'}}}"></div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="accordion">
                            <button onclick="accordion.click(this)" class="accordion-toggle secondary"
                                    data-bind="css: { toggled: lupapisteApp.models.applicationAuthModel.ok('enable-accordions')}">
                                <i class="lupicon-chevron-down"></i>
                                <i class="lupicon-chevron-up toggle"></i>
                                <span class="bar-text" data-bind="lhtml: 'application.neighbors.hearings'" style="margin-right: 0">Kuulemiset</span>
                            </button>
                            <div class="accordion_content" data-accordion-state="closed"
                                 data-bind="
                                        attr: {'data-accordion-state': lupapisteApp.models.applicationAuthModel.ok('enable-accordions') ? 'open' : 'closed'},
                                        css: { expanded: lupapisteApp.models.applicationAuthModel.ok('enable-accordions')}
                                        ">
                                <div class="accordion-fields" data-bind="if: summaryAvailable">
                                    <div data-bind="template: {name: 'neighbors-template', data: {neighbors: $data.neighbors, localisationKeys: {missing: 'neighbors.missing-from-prev-permit'}}}"></div>
                                </div>
                            </div>
                        </section>

                        <!-- /ko -->

                        <div class="process-nav">
                            <a class="btn secondary process-previous" data-bind="click: $root.application.nextTab" href="#" data-target="attachments">
                                <i class="lupicon-chevron-left"></i>
                                <span data-bind="ltext: 'application.previous-tab'"></span>
                            </a>
                        </div>

                    </div>

                    <!-- Verdict tab -->

                    <!-- ko if: selectedTabName() === 'verdict' -->
                    <div id="application-verdict-tab" class="tab-content">
                        <h1 data-bind="ltext: 'application.tabVerdict' + $root.application.verdictPostfix()"></h1>
                        <span data-bind="{component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.' + $root.application.permitType() + '.verdictDesc' + $root.application.verdictPostfix()}
                                         }}"></span>

                        <div data-bind="if: $root.verdictModel.verdicts()">
                            <div data-bind="ifnot: $root.verdictModel.verdicts().length">
                                <p data-bind="lhtml: 'application.verdictDesc'"></p>
                            </div>
                            <div data-bind="template: 'verdicts-template'"></div>
                        </div>

                        <button data-bind="click: $root.verdictModel.newVerdict, visible: $root.authorization.ok('new-verdict-draft'), disable: $root.verdictModel.newProcessing"
                                class="positive"
                                data-test-id="give-verdict">
                            <em data-bind="visible: $root.verdictModel.newPending" class="button-loader"></em>
                            <span data-bind="ltext: 'application.verdict.add'"></span>
                        </button>

                        <button data-bind="click: $root.verdictModel.checkVerdict,
                                           visible: $root.authorization.ok('check-for-verdict'),
                                           disable: $root.verdictModel.processing,
                                           css: {waiting: $root.verdictModel.pending}"
                                class="positive"
                                data-test-id="fetch-verdict">
                          <i class="wait spin lupicon-refresh"></i>
                          <span data-bind="ltext: 'verdict.fetch.button'"></span>
                        </button>

                        <button data-bind="click: $root.verdictAttachmentPrintsOrderModel.openDialog,
                                           enable: !$root.verdictModel.processing(),
                                           visible: $root.authorization.ok('order-verdict-attachment-prints'),
                                           attr: {'title': $root.verdictAttachmentPrintsOrderModel.printsOrderButtonTitle}"
                                class="positive"
                                data-test-id="test-order-attachment-prints">
                            <em data-bind="visible: $root.verdictModel.pending" class="button-loader"></em>
                            <span data-bind="ltext: 'verdict.orderAttachmentPrints.button'"></span>
                        </button>

                        <a data-bind="click: $root.verdictAttachmentPrintsOrderHistoryModel.openPrintsOrderHistoryDialog,
                                      ltext: 'application.printsOrderHistory',
                                      visible: $root.authorization.ok('order-verdict-attachment-prints') && $root.verdictAttachmentPrintsOrderHistoryModel.historyItems().length"
                           href="#" data-test-id="test-open-prints-order-history"></a>

                    </div>
                    <!-- /ko -->

                    <!-- Pate verdict tab -->
                    <!-- ko if: selectedTabName() === 'pate-verdict' && lupapisteApp.models.rootVMO.currentPage() === 'application' -->
                    <div id="application-pate-verdict-tab"
                         class="tab-content feature--no-border" data-bind="feature: 'pate'">
                      <!-- ko if: $root.authorization.ok( 'pate-contract-tab') -->
                      <cljs-pate_verdicts params="contracts: true"></cljs-pate_verdicts>
                      <!-- /ko -->
                      <!-- ko ifnot: $root.authorization.ok( 'pate-contract-tab') -->
                      <cljs-pate_verdicts></cljs-pate_verdicts>
                      <!-- /ko -->

                    </div>
                    <!-- /ko -->

                    <!-- Statements tab -->

                    <!-- ko if: selectedTabName() === 'statement' && application.id() -->
                    <div id="application-statement-tab" class="tab-content">
                        <div data-bind="component: {name: 'statements-tab',
                                                    params: {application: application,
                                                             authModel: $root.authorization}}"></div>
                    </div>
                    <!-- /ko -->

                    <!-- Archival tab -->

                    <!--ko if: selectedTabName() === 'archival' && $root.authorization.ok("archiving-operations-enabled") -->
                    <div id="application-archival-tab" class="tab-content">
                      <div>
                        <div data-bind="component: {name: 'archival-summary', params: {application: application}}"></div>
                      </div>
                    </div>
                    <!-- /ko -->

                    <!--ko if: selectedTabName() === 'caseFile' && $root.authorization.ok("permanent-archive-enabled") && $root.authorization.ok('case-file-data') && application.id -->
                    <div id="application-caseFile-tab" class="tab-content">
                      <div>
                        <div data-bind="component: {name: 'case-file', params: {application: application, authModel: $root.authorization}}"></div>
                      </div>
                    </div>
                    <!-- /ko -->

                  <!-- ko if: selectedTabName() === 'inspectionSummaries' && !_.isEmpty($root.application.id()) && $root.authorization.ok('inspection-summaries-for-application') -->
                  <div id="application-inspectionSummaries-tab" class="tab-content">
                    <cljs-inspection-summaries params="{app: $data.application, authModel: $root.authorization}"></cljs-inspection-summaries>
                  </div>
                  <!-- /ko -->

                    <!-- YMP Bulletin tab -->
                    <!-- ko if: selectedTabName() === 'ymp-bulletin' && $root.authorization.ok('ymp-publish-bulletin-enabled') -->
                    <div id="application-ymp-bulletin-tab" data-bind="with: application" class="tab-content">
                        <div data-bind="component: {name: 'ymp-bulletin-tab',
                                                    params: {appId: id,
                                                             appState: state,
                                                             authModel: $root.authorization,
                                                             bulletinService: lupapisteApp.services.publishBulletinService}}"></div>
                    </div>

                    <!-- /ko -->
                    <!-- / Bulletin tab -->

                  <!-- Generic Bulletin tab -->
                  <!-- ko if: selectedTabName() === 'bulletin' && $root.authorization.ok('bulletin-for-application-verdict-enabled') -->
                  <div id="application-bulletin-tab" data-bind="with: application" class="tab-content">
                    <div data-bind="component: {name: 'generic-bulletin-tab',
                                                params: {appId: id}}"></div>
                  </div>

                  <!-- /ko -->
                  <!-- / Bulletin tab -->

                  <script type="text/x-jquery-tmpl" id="verdicts-template">
                      <div class="application_section" data-bind="foreach: $root.verdictModel.verdicts">

                          <h2 class="application_section_header">
                              <span data-bind="ltext: 'verdict.id'"></span>:
                              <span data-bind="text: $data.kuntalupatunnus, attr: {'data-test-id' : 'given-verdict-id-' + $index()}"></span>
                              <span data-bind="visible: $data.draft" style="text-transform: lowercase;">(<span data-bind="ltext: 'draft'"></span>)</span>

                              <i class="primary lupicon-remove is-right"
                                  data-test-id="delete-verdict-from-listing"
                                  data-bind="click: $root.verdictModel.deleteVerdict,
                                  visible: $root.authorization.ok('delete-verdict'),
                                  enable: $root.authorization.ok('delete-verdict'),
                                             attr: {'title': loc('remove')}">
                              </i>
                          </h2>

                          <!--  ko if:  $data.paatokset -->
                          <div data-bind="foreach: paatokset, attr: {'data-test-id' : 'given-verdict-id-' + $index() + '-content'}">
                              <div class="accordion">
                                  <button onclick="accordion.click(this)"
                                          class="accordion-toggle secondary toggled">
                                      <i class="lupicon-chevron-down"></i>
                                      <i class="lupicon-chevron-up toggle"></i>
                                      <span class="bar-text">
                                          <span data-bind="ltext: 'application.verdict.title' + $root.application.verdictPostfix()" style="margin-right: 0"></span>
                                          <span data-bind="text: $index() + 1"></span>
                                      </span>
                                  </button>
                                  <div class="accordion_content expanded verdict-content">

                                      <div data-bind="with: $parent" style="overflow: auto;">
                                          <div class="btn-container right-align"  data-bind="if: $data.draft" >
                                              <button data-bind="visible: $root.authorization.ok('save-verdict-draft'), click: function() {$root.verdictModel.openVerdict($root, $data);}, ltext: 'edit'"
                                                      class="btn btn-primary" data-test-id="edit-verdict"></button>
                                              <button data-bind="visible: $root.authorization.ok('publish-verdict'), enable: $data.canBePublished, click: function() {$root.verdictModel.publishVerdict($root, $data);}, ltext: 'verdict.submit'"
                                                      class="btn btn-primary" data-test-id="publish-verdict"></button>
                                          </div>
                                      </div>

                                      <div class="accordion-fields">
                                          <div class="verdict-info-fields">
                                              <div class="verdict-signature-fields" data-bind="visible: !$parent.draft && $parent.sopimus">
                                                  <h3 data-bind="ltext: 'verdict.signatures'"></h3>

                                                  <div data-bind="foreach: $data.signatures">
                                                      <div data-test-id="verdict-signature-listing">
                                                          <label data-bind="fullName: $data.user"></label>
                                                          <span class="value" data-bind="dateString: created"></span>
                                                      </div>
                                                  </div>

                                                  <div data-bind="if: $root.authorization.ok('sign-verdict') && !$root.verdictModel.verdictSignedByUser($data)" data-test-id="verdict-signature-ui">
                                                      <span data-bind="ltext: 'verdict.signature.description'"></span>
                                                      <br/>
                                                      <button class="btn btn-primary" data-bind="click: $root.verdictModel.openSigningDialog, ltext: 'verdict.sign'" data-test-id="sign-verdict-button"></button>
                                                  </div>
                                              </div>

                                              <div data-bind="if: $data.paivamaarat">
                                                  <div data-bind="if: paivamaarat.anto" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.anto'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.anto"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.paatosdokumentinPvm" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.paatosdokumentinPvm'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.paatosdokumentinPvm"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.paatosPvm" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.paatosPvm'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.paatosPvm"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.julkipano" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.julkipano'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.julkipano"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.viimeinenValitus" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.viimeinenValitus'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.viimeinenValitus"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.aloitettava" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.aloitettava'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.aloitettava"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.voimassaHetki" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.voimassaHetki'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.voimassaHetki"></span>
                                                  </div>
                                                  <div data-bind="if: paivamaarat.raukeamis" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.raukeamis'"></label>
                                                      <span class="value" data-bind="dateString: paivamaarat.raukeamis"></span>
                                                  </div>
                                              </div>
                                          </div>

                                          <div>
                                            <!--  ko if:  $data.lupamaaraykset -->
                                            <h2 data-bind="ltext: 'verdict.lupamaaraukset',
                                                           testId: 'verdict-requirements-' + $parentContext.$index()"></h2>
                                              <div class="accordion-content-part">
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaEnintaan" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaEnintaan'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaEnintaan"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaVahintaan" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaVahintaan'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaVahintaan"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaRakennettava" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaRakennettava'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaRakennettava"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaRakennettu" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaRakennettu'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaRakennettu"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaKiinteistolla" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaKiinteistolla'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaKiinteistolla"></span></div>
                                                  <div data-bind="if: lupamaaraykset.autopaikkojaUlkopuolella" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.autopaikkojaUlkopuolella'"></label><span class="value" data-bind="text: lupamaaraykset.autopaikkojaUlkopuolella"></span></div>
                                                  <div data-bind="if: lupamaaraykset.kerrosala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.kerrosala'"></label><span class="value" data-bind="text: lupamaaraykset.kerrosala"></span></div>
                                                  <div data-bind="if: lupamaaraykset.rakennusoikeudellinenKerrosala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.rakennusoikeudellinenKerrosala'"></label><span class="value" data-bind="text: lupamaaraykset.rakennusoikeudellinenKerrosala"></span></div>
                                                  <div data-bind="if: lupamaaraykset.kokonaisala" class="key-value-pair">
                                                      <label data-bind="ltext: 'verdict.kokonaisala'"></label><span class="value" data-bind="text: lupamaaraykset.kokonaisala"></span></div>

                                                  <div data-bind="if: lupamaaraykset.vaaditutTyonjohtajat && lupamaaraykset.vaaditutTyonjohtajat.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.vaaditutTyonjohtajat'"></h3>
                                                      <span class="value" data-bind="text: lupamaaraykset.vaaditutTyonjohtajat"></span>
                                                  </div>

                                                  <div data-bind="if: lupamaaraykset.vaaditutErityissuunnitelmat && lupamaaraykset.vaaditutErityissuunnitelmat.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.vaaditutErityissuunnitelmat'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.vaaditutErityissuunnitelmat">
                                                          <li data-bind='text: $data'></li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind="if: lupamaaraykset.muutMaaraykset && lupamaaraykset.muutMaaraykset.length" class="key-value-pair">
                                                      <h3 data-bind="ltext: 'verdict.muutMaaraykset'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.muutMaaraykset">
                                                          <li data-bind='text: $data'></li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind='if: lupamaaraykset.vaaditutKatselmukset && lupamaaraykset.vaaditutKatselmukset.length'>
                                                      <h3 data-bind="ltext: 'verdict.vaaditutKatselmukset'"></h3>
                                                      <ul data-bind="foreach: lupamaaraykset.vaaditutKatselmukset">
                                                          <li data-bind="if: $data.katselmuksenLaji">
                                                              <!-- ko if: loc.hasTerm('task-katselmus.katselmuksenLaji.' + $data.katselmuksenLaji) -->
                                                            <span data-bind="if: !$data.tarkastuksenTaiKatselmuksenNimi">
                                                              <span data-bind="ltext: 'task-katselmus.katselmuksenLaji.'+ $data.katselmuksenLaji"></span>
                                                            </span>
                                                              <!-- /ko -->
                                                            <span data-bind="if: $data.tarkastuksenTaiKatselmuksenNimi">
                                                              <span data-bind="text: $data.tarkastuksenTaiKatselmuksenNimi"></span>
                                                            </span>
                                                          </li>
                                                      </ul>
                                                  </div>

                                                  <div data-bind='if: lupamaaraykset.maaraykset && lupamaaraykset.maaraykset.length'>
                                                      <h3 data-bind="ltext: 'verdict.maaraykset'"></h3>
                                                      <table class="table table-striped tablesorter">
                                                          <thead>
                                                              <tr>
                                                                  <th data-bind="ltext: 'verdict.maaraykset.maaraysaika'" style="width: 25%"></th>
                                                                  <!-- <th data-bind="ltext: 'verdict.maaraykset.toteutusHetki'"></th> -->
                                                                  <th data-bind="ltext: 'verdict.maaraykset.sisalto'"></th>
                                                              </tr>
                                                          </thead>
                                                          <tbody data-bind="foreach: lupamaaraykset.maaraykset">
                                                              <tr>
                                                                  <td data-bind='dateString: $data.maaraysaika'></td>
                                                                  <!-- <td data-bind='dateString: toteutusHetki'></td> -->
                                                                  <td data-bind='text: $data.sisalto' class="verdict-text"></td>
                                                              </tr>
                                                          </tbody>
                                                      </table>
                                                  </div>
                                                  <!-- /ko -->
                                              </div>
                                              <!-- /ko -->
                                              <!-- /lupamaaraykset -->

                                              <h2 data-bind="ltext: 'verdict.poytakirjat'"></h2>
                                              <div class="accordion-content-part">

                                                  <!--  ko if:  $data.poytakirjat && $data.poytakirjat.length -->
                                                  <table class="table table-striped tablesorter" id="application-verdict-details">
                                                      <thead>
                                                          <tr>
                                                              <th data-bind="ltext: 'verdict.status' + $root.application.verdictPostfix()" colspan="2"></th>
                                                              <th data-bind="ltext: 'verdict.pykala'"></th>
                                                              <th data-bind="ltext: 'verdict.name' + $root.application.verdictPostfix()"></th>
                                                              <th data-bind="ltext: 'verdict.paatospvm'"></th>
                                                              <th data-bind="ltext: 'verdict.attachments'"></th>
                                                          </tr>
                                                      </thead>
                                                      <tbody data-bind="foreach: $data.poytakirjat">
                                                          <tr class="statement-row">
                                                              <td>
                                                                <!-- ko if: $data.status -->
                                                                <span data-bind="ltext: 'verdict.status.'+$data.status"></span>
                                                                <!-- /ko -->
                                                                <!-- ko if: !$data.status && $data.paatoskoodi -->
                                                                <span data-bind="text: $data.paatoskoodi"></span>
                                                                <!-- /ko -->
                                                              </td>
                                                              <td data-bind="text: $data.paatos" class="verdict-text"></td>
                                                              <td data-bind="text: $data.pykala"></td>
                                                              <td data-bind="text: $data.paatoksentekija"></td>
                                                              <td data-bind="dateString: $data.paatospvm"></td>
                                                              <td data-bind="foreach: $data.attachments">
                                                                  <span data-bind="with: $data.latestVersion">
                                                                      <a href="#" data-bind="text: filename, attr: {href: '/api/raw/latest-attachment-version?attachment-id=' + $parent.id}" target="_blank"></a><br/>
                                                                      <i data-bind="ltext: contentType"></i>
                                                                      <i data-bind="size: size"></i><br/>
                                                                  </span>
                                                              </td>
                                                          </tr>
                                                      </tbody>
                                                  </table>
                                                  <!-- /ko --> <!-- /poytakirjat -->

                                                  <!--  ko ifnot:  $data.poytakirjat && $data.poytakirjat.length -->
                                                  <div data-bind="ltext: 'verdict.poytakirjat.missing'"></div>
                                                  <!-- /ko -->
                                              </div>
                                              <!-- Muutoksenhaku -->
                                              <!-- ko ifnot: $parentContext.$data.draft -->
                                              <div data-bind="component: {name: 'verdict-appeal',
                                                              params: {id: verdict.id, test: $parentContext.$index() + '-' +$index()}}"></div>
                                              <!-- /ko -->
                                          </div>
                                      </div>
                                  </div>
                              </div>
                          </div>
                          <!-- /ko --> <!-- /paatokset -->
                      </div>
                    </script>

                    <script type="text/x-jquery-tmpl" id="neighbors-template">
                        <div data-bind="ifnot: neighbors() && neighbors().length > 0">
                            <p data-bind="ltext: $data.localisationKeys.missing" data-test-id="application-no-neigbors"></p>
                        </div>

                        <div data-bind="if: neighbors() && neighbors().length > 0">
                            <table class="neighbors">
                                <thead>
                                    <tr>
                                        <th data-bind="ltext: 'neighbors.propertyId'"></th>
                                        <th data-bind="ltext: 'neighbors.owner'"></th>
                                        <th data-bind="ltext: 'neighbors.status'"></th>
                                        <th data-bind="ltext: 'neighbors.actions'"></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: neighbors">
                                    <tr data-bind="attr: {'data-test-id': 'neighbors-row-email-' + owner.email()}">
                                        <td data-bind="propertyId: propertyId"></td>
                                        <td data-bind="with: owner">
                                            <span data-bind="text: name" class="owner-name"></span>
                                            <span data-bind="text: address.street" class="owner-street"></span>
                                            <span data-bind="text: address.zip" class="owner-zip"></span>
                                            <span data-bind="text: address.city" class="owner-city"></span>
                                            <span data-bind="text: email" class="owner-email"></span>
                                        </td>
                                        <td>
                                            <a data-bind="visible: $root.neighbor.statusCompleted($data),
                                                          click: $root.neighbor.showStatus,
                                                          attr: {'data-test-id': 'neighbors-row-status-' + _.last(status()).state()}"
                                               href="#">
                                                <span data-bind="text: loc(['neighbor.state', _.last(status()).state()])" class="status-state"></span>
                                            </a>
                                            <span data-bind="visible: !$root.neighbor.statusCompleted($data),
                                                             text: loc(['neighbor.state', _.last(status()).state()]),
                                                             attr: {'data-test-id': 'neighbors-row-status-' + _.last(status()).state()}"
                                                  class="status-state">
                                            </span>
                                            <span data-bind="dateTimeString: _.last(status()).created()" class="status-time"></span>
                                        </td>
                                        <td>
                                            <span data-bind="visible: !$root.neighbor.statusCompleted($data)">
                                                <a data-bind="click: $root.sendNeighborEmailModel.open,
                                                              visible: $root.authorization.ok('neighbor-send-invite'),
                                                              ltext: 'neighbors.actions.sendEmail'"
                                                   data-test-id="neighbor-row-invite"
                                                   class="command"
                                                   href="#">
                                                </a>
                                                <a data-bind="click: $root.neighbor.markDone,
                                                              visible: _.last(status()).state() != 'mark-done' && $root.authorization.ok('neighbor-mark-done'),
                                                              ltext: 'neighbors.actions.markDone',
                                                              clickBubble: false"
                                                   data-test-id="neighbor-row-mark-done"
                                                   class="command"
                                                   href="#">
                                                </a>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </script>

                    <!-- Tasks tab -->
                    <!-- ko if: selectedTabName() === 'tasks' && $root.authorization.ok('tasks-tab-visible') -->
                    <div id="application-tasks-tab" data-bind="with: $root.application" class="tab-content" >

                        <!-- ko if: $root.authorization.ok('ya-application') -->
                        <h1 data-bind="ltext: 'application.tabConstructionTimeTasksYA'"></h1>
                        <!-- /ko -->
                        <!-- ko if: !$root.authorization.ok('ya-application') -->
                        <h1 data-bind="ltext: 'application.tabConstructionTimeTasks'"></h1>
                        <!-- /ko -->

                        <span data-bind="component: {
                                         name: 'help-toggle',
                                         params: {lhtml: 'help.' + permitType() + '.tasksDesc'}
                                         }"></span>

                        <extension-applications></extension-applications>

                        <div data-bind="if: _.some( _js.buildings ) && $root.authorization.ok('inform-building-construction-started')">
                          <h2 data-bind="ltext:'application.aloitusilmoitukset'"></h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th data-bind="ltext: 'application.buildingStatus'"></th>
                                        <th data-bind="ltext: 'application.buildingOperation'"></th>
                                        <th data-bind="ltext: 'application.buildingStartedDate'"></th>
                                        <th data-bind="ltext: 'application.buildingStartedBy'"></th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: buildings">
                                    <tr>
                                        <td><span data-bind="attr: {'class': ($data.constructionStarted ? 'ok': 'missing')  + ' icon'}"></span></td>
                                        <td data-bind="text: util.buildingName($data)"></td>
                                        <td>
                                            <span data-bind="if: !$data.constructionStarted">
                                                <a data-bind="click: $root.constructionStateChangeModel.openBuildingConstructionStartDialog, ltext: 'application.beginConstructionOf'" href="#"></a>
                                            </span>
                                            <span data-bind="if: $data.constructionStarted">
                                                <span data-bind="dateString: $data.constructionStarted"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.startedBy"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- YA: Info about construction started and construction ready occasions -->
                        <div data-bind="if: $root.authorization.ok('info-construction-status')">
                          <h2 data-bind="ltext: 'application.aloitusjavalmistumisilmoitukset'"></h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th data-bind="ltext: 'application.constructionStateChangeOperation'"></th>
                                        <th data-bind="ltext: 'application.constructionStateChangeDate'"></th>
                                        <th data-bind="ltext: 'application.constructionStateChangedBy'"></th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>

                                    <!-- Hanke aloitettu -->
                                    <tr>
                                        <td><span data-bind="ltext: 'constructionStarted'"></span></td>
                                        <td>
                                            <span data-bind="if: $data.started">
                                                <span data-bind="dateString: $data.started"
                                                      data-test-id="construction-state-change-info-started"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.startedBy"
                                            data-test-id="task-started-by"></td>
                                        <td>
                                            <button class="btn btn-primary"
                                                    data-test-id="application-inform-construction-started-btn"
                                                    data-bind="click: $root.constructionStateChangeModel.openConstructionStartDialog,
                                                               ltext: 'application.button.informConstructionStarted',
                                                               visible: $root.authorization.ok('inform-construction-started'),
                                                               enable: $root.authorization.ok('inform-construction-started')"></button>
                                        </td>
                                    </tr>

                                    <!-- Hanke valmistunut -->
                                    <tr>
                                        <td><span data-bind="ltext: 'closed'"></span></td>
                                        <td>
                                            <span data-bind="if: $data.closed">
                                                <span data-bind="dateString: $data.closed"
                                                      data-test-id="construction-state-change-info-closed"></span>
                                            </span>
                                        </td>
                                        <td data-bind="fullName: $data.closedBy"
                                            data-test-id="task-closed-by"></td>
                                        <td>
                                            <button class="btn btn-primary"
                                                    data-test-id="application-inform-construction-ready-btn"
                                                    data-bind="click: $root.constructionStateChangeModel.openConstructionReadyDialog,
                                                               ltext: 'application.button.informConstructionReady',
                                                               visible: $root.authorization.ok('inform-construction-ready'),
                                                               enable: $root.authorization.ok('inform-construction-ready')"></button>
                                        </td>
                                    </tr>

                                    <!-- Takuu alkaa -->
                                    <tr data-bind="if: showWarrantyStart">
                                        <td><span data-bind="ltext: 'application.warranty.start'"></span></td>
                                        <td>
                                            <!-- ko if: lupapisteApp.models.currentUser.isApplicant -->
                                            <span data-bind="dateString: warrantyStart"
                                                  data-test-id="warranty-start-date-text"></span>
                                            <!-- /ko -->
                                            <!-- ko if: lupapisteApp.models.currentUser.isAuthority -->
                                            <input type="text" data-bind="datepicker: warrantyStart,
                                                                          dateInvalidClass: ''"
                                                   class="form-input"
                                                   data-test-id="warranty-start-date-edit">
                                            <!-- /ko -->
                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                    <!-- Takuu loppuu -->
                                    <tr data-bind="if: showWarrantyEnd">
                                        <td><span data-bind="ltext: 'application.warranty.end'"></span></td>
                                        <td>
                                            <!-- ko if: lupapisteApp.models.currentUser.isApplicant -->
                                            <span data-bind="dateString: warrantyEnd"
                                                  data-test-id="warranty-end-date-text"></span>
                                            <!-- /ko -->
                                            <!-- ko if: lupapisteApp.models.currentUser.isAuthority -->
                                            <input type="text" data-bind="datepicker: warrantyEnd" class="form-input"
                                                   data-test-id="warranty-end-date-edit">
                                            <!-- /ko -->
                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>

                                </tbody>
                            </table>
                        </div>

                        <!-- ko if: $root.foreman.isVisible -->
                        <div data-bind="template: {name: 'application-foreman-tasks-template', data: $root.foreman}"></div>
                        <div data-bind="template: {name: 'all-foremen-table-template', data: $root.foreman}"></div>
                        <!-- /ko -->

                        <review-tasks params="openTask: openTask"></review-tasks>

                        <div class="tasks-content">
                            <div data-bind="foreach: taskGroups">
                                <h2 data-bind="text: name"></h2>
                                <div class="stacked legends">
                                    <div class="like-btn">
                                        <i class="lupicon-circle-check"></i>
                                        <span data-bind="ltext: 'task.ok.title'"></span>
                                    </div>
                                    <div class="like-btn">
                                        <i class="lupicon-circle-attention"></i>
                                        <span data-bind="ltext: 'task.missing.title'"></span>
                                    </div>
                                </div>
                                <table class="tasks" data-test-id="lupamaaraykset">
                                    <thead>
                                        <tr>
                                            <th data-bind="ltext: 'application.taskState'"></th>
                                            <th data-bind="ltext: 'application.taskDisplayName'"></th>
                                            <th data-bind="ltext: 'application.taskClosed'"></th>
                                        </tr>
                                    </thead>
                                    <tbody data-bind="foreach: tasks">
                                        <tr data-bind="attr: {'data-test-type': schema.info.name}">
                                            <td><i data-bind="attr: {
                                                              'class': LUPAPISTE.statusIcon(statusName),
                                                              'data-test-state': $data.state,
                                                              'title': loc(['task', statusName, 'title'])}"></i></td>
                                            <td><a href="#" class="task-title"
                                                   data-bind="click: openTask, text: displayName"></a></td>
                                            <td data-bind="text: util.getIn($data, ['data', 'katselmus', 'pitoPvm', 'value'])"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <button class="positive"
                                data-test-id="application-new-task"
                                data-bind="click: _.partialRight( $root.createTask.createTask, true ),
                                           ltext: 'task.create',
                                           visible: $root.authorization.ok('create-task'),
                                           enable: $root.authorization.ok('create-task')"></button>
                    </div>
                    <!-- /ko -->
                    <!-- ko if: $root.hasEditableDocs -->
                    <div id="construction-time-documents" data-bind="visible: selectedTabName() === 'tasks' && $root.authorization.ok('tasks-tab-visible')">
                      <p data-bind="lhtml: 'required.field.desc'"></p>
                      <div class="application_section">
                        <div id="constructionTimeDocgen" class="docgen-content">
                          <!-- This is where generated document will be placed. -->
                        </div>
                      </div>
                    </div>
                    <!-- /ko -->

                    <!-- Calendars tab -->
                    <!-- ko if: selectedTabName() === 'calendar' && lupapisteApp.models.rootVMO.currentPage() === 'application' && calendarConfig.initialized -->
                    <div id="application-calendar-tab" data-bind="visible: $root.authorization.ok('calendars-enabled')" class="tab-content">
                      <!-- ko if: lupapisteApp.models.currentUser.isAuthority -->
                        <application-authority-calendar params="calendarConfig: calendarConfig" />
                      <!-- /ko -->
                      <!-- ko if: lupapisteApp.models.currentUser.isApplicant -->
                        <applicant-calendar params="calendarConfig: calendarConfig"/>
                      <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>
            </div>
            <div id="boxes">

                <div id="dialog-invite-foreman" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.parties.addForeman'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <!-- ko with: $root.foreman -->
                    <div class="dialog-content">
                        <!-- ko if: finished -->
                        <div class="finished">
                            <p class="dialog-desc-wide" data-bind="lhtml: 'invite.foreman.finished'"></p>
                            <button data-test-id="application-invite-foreman-close-dialog"
                                    class="btn btn-dialog btn-primary"
                                    data-bind="ltext: 'button.ok', click: function() { openApplication(finished()); LUPAPISTE.ModalDialog.close(); }"></button>
                            <a class="btn btn-dialog" data-bind="ltext: 'application.return', click: function() { LUPAPISTE.ModalDialog.close(); }"></a>
                        </div>
                        <!-- /ko -->
                        <!-- ko if: pending -->
                        <div class="pending">
                            <div class="ajax"></div>
                            <div data-bind="ltext: 'invite.foreman.pending'"></div>
                        </div>
                        <!-- /ko -->
                        <!-- ko ifnot: finished -->
                        <form>
                            <p data-bind="lhtml: 'invite.foreman.desc'" class="dialog-desc-wide"></p>
                            <label for="foreman-role" data-bind="ltext: 'foreman.role'"></label>
                            <select name="foreman-role" id="foreman-role" class="form-input combobox long"
                                    data-bind="options: foremanRoles,
                                               optionsText: function(item) { return loc(item.i18nkey); },
                                               optionsValue: 'name',
                                               value: selectedRole,
                                               optionsCaption: loc('choose')"></select>

                            <label data-bind="ltext: 'userinfo.email'" class="form-label" for="invite-foreman-email"></label>
                            <input class="form-input text long" id="invite-foreman-email" type="text" data-bind="textInput: email" autofocus>
                            <div data-bind="visible: error" >
                                <div data-bind="ltext: error" class="context-error"></div>
                            </div>
                            <button class="btn btn-primary btn-dialog" data-test-id="application-invite-foreman" data-bind="click: submit, disable: disabled">
                                <span data-bind="ltext: 'application.inviteSend'"></span>
                                <em data-bind="visible: pending" class="button-loader"></em>
                            </button>
                            <a data-bind="ltext: 'cancel'" class="btn-dialog close cancel" href="#" data-test-id="cancel-foreman-dialog"></a>
                        </form>
                        <!-- /ko -->
                    </div>
                    <!-- /ko -->
                </div>

                <div id="dialog-valtuutus" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.addInvite'">Lis&auml;&auml; valtuutus</p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div class="dialog-content">
                        <p data-bind="ltext: 'invite.desc'" class="dialog-desc"> </p>
                        <form data-bind="with: $root.invite">
                            <!-- label data-bind="ltext: 'userinfo.role'" class="form-label" for="invite-document"></label -->
                            <input class="form-input text long" id="invite-document-name" disabled="disabled" type="hidden" data-bind="value: documentName" />
                            <input class="form-input text long" id="invite-document-id" disabled="disabled" type="hidden" data-bind="value: documentId" />
                            <input class="form-input text long" id="invite-document-path" disabled="disabled" type="hidden" data-bind="value: path" />
                            <label data-bind="ltext: 'userinfo.email'" class="form-label" for="invite-email"></label>
                            <input class="form-input text long" id="invite-email" type="text" data-bind="textInput: email" />
                            <label data-bind="ltext: 'application.inviteMessage'" class="form-label" for="invite-text"></label>
                            <textarea id="invite-text" rows=10 class="form-input textarea really-long high" data-bind="textInput: text"></textarea>
                            <div data-bind="visible: error" >
                                <div data-bind="text: error" class="context-error"></div>
                            </div>
                            <button class="btn btn-primary btn-dialog" data-test-id="application-invite-submit" data-bind="click: submit, disable: disabled">
                                <span data-bind="ltext: 'application.inviteSend'"></span>
                                <em data-bind="visible: pending" class="button-loader"></em>
                            </button>
                        </form>
                    </div>
                </div>

                <div id="dialog-valtuutus-yrityskayttaja-suunnittelijaksi" class="window autosized">
                  <div class="dialog-header">
                    <p data-bind="ltext: 'application.addInvite'">Lis&auml;&auml; valtuutus</p>
                    <p class="dialog-close close lupicon-remove"></p>
                  </div>
                  <div class="dialog-content">
                    <p data-bind="ltext: 'document.party.person-select.designer.areyousure'" class="dialog-desc"></p>
                    <p>&nbsp;</p>
                    <form data-bind="with: $root.invite">
                        <input class="form-input text long" id="invite-document-name" disabled="disabled" type="hidden" data-bind="value: documentName" />
                        <input class="form-input text long" id="invite-document-id" disabled="disabled" type="hidden" data-bind="value: documentId" />
                        <input class="form-input text long" id="invite-document-path" disabled="disabled" type="hidden" data-bind="value: path" />
                        <label data-bind="ltext: 'userinfo.email'" class="form-label" for="invite-email"></label>
                        <input class="form-input text long" id="invite-email" type="text" disabled="disabled" data-bind="textInput: email" />
                        <label data-bind="ltext: 'application.inviteMessage'" class="form-label" for="invite-text"></label>
                        <textarea id="invite-text" rows=10 class="form-input textarea really-long high" data-bind="textInput: text"></textarea>
                        <div data-bind="visible: error" >
                        <div data-bind="text: error" class="context-error"></div>
                      </div>
                      <p data-bind="ltext: 'document.party.person-select.remove-existing-role-before-invite', visible: hasReaderRole"></p>
                      <button class="btn btn-primary btn-dialog negative" data-test-id="application-invite-submit" data-bind="click: removeExistingAuth, visible: hasReaderRole">
                        <span data-bind="ltext: 'document.party.person-select.remove-auth'"></span>
                        <em data-bind="visible: pending" class="button-loader"></em>
                      </button>
                      <button class="btn btn-primary btn-dialog" data-test-id="application-invite-submit" data-bind="click: submit, disable: disabled, visible: !hasReaderRole()">
                        <span data-bind="ltext: 'application.inviteSend'"></span>
                        <em data-bind="visible: pending" class="button-loader"></em>
                      </button>
                    </form>
                  </div>
                </div>

                <div id="dialog-add-attachment-templates" class="window autosized selectm-dialog">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'application.newAttachmentTemplates'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div class="dialog-content">
                        <div class="attachment-templates"></div>
                    </div>
                </div>

                <div id="dialog-send-neighbor-email" class="window autosized">
                    <div data-bind="with: $root.sendNeighborEmailModel">
                        <div class="dialog-header">
                            <p data-bind="ltext: 'neighbors.sendEmail.title'"></p>
                            <p class="dialog-close close lupicon-remove"></p>
                        </div>
                        <div class="dialog-content">

                            <form>
                                <label data-bind="ltext: 'neighbors.sendEmail.name'" class="form-label"></label>
                                <span data-bind="text: name"
                                      id="neighbors-sendemail-name"
                                      class="form-input text long">
                                </span>

                                <label data-bind="ltext: 'neighbors.sendEmail.email'" class="form-label" for="neighbors-sendemail-email"></label>
                                <input data-bind="textInput: email,
                                                  attr: {placeholder: loc('neighbors.sendEmail.email.placeholder')}"
                                       id="neighbors-sendemail-email"
                                       class="form-input text long" >
                                <div class="neighbor-error"
                                     data-bind="visible: error,
                                                ltext: error"></div>
                            </form>

                            <button data-bind="click: send, ltext: 'neighbors.sendEmail.ok', enable: ok"
                                    data-test-id="neighbors-sendemail-send"
                                    class="positive btn-dialog">
                            </button>
                            <button data-bind="ltext: 'neighbors.sendEmail.cancel'"
                                    class="secondary btn-dialog close"></button>
                        </div>
                    </div>
                </div>

                <div id="dialog-neighbor-status" class="window autosized">
                    <div class="dialog-header">
                        <p data-bind="ltext: 'neighbors.status-dialog.title'"></p>
                        <p class="dialog-close close lupicon-remove"></p>
                    </div>
                    <div data-bind="with: neighborStatusModel" class="dialog-content">

                        <div data-bind="text: loc(['neighbors.status-dialog.message', state()])"></div>
                        <div data-bind="text: loc(['neighbors.status-dialog.description', state()])"></div>

                        <table>
                            <tbody>
                                <tr>
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.firstName'"></td>
                                    <td data-bind="text: firstName" data-test-id="neighbor-status-firstName"></td>
                                </tr>
                                <tr>
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.lastName'"></td>
                                    <td data-bind="text: lastName" data-test-id="neighbor-status-lastName"></td>
                                </tr>
                                <tr data-bind="if: userid">
                                    <td data-bind="ltext: 'neighbors.status-dialog.user.userid'"></td>
                                    <td data-bind="text: userid" data-test-id="neighbor-status-userid"></td>
                                </tr>
                            </tbody>
                        </table>

                        <div>
                            <span data-bind="ltext: 'neighbors.status-dialog.user.time'"></span>:
                            <span data-bind="dateTimeString: created"></span>
                        </div>

                        <div data-bind="visible: message">
                            <div data-bind="text: loc(['neighbors.status-dialog.message-title', state()])"></div>
                            <div data-bind="text: message"  data-test-id="neighbor-status-message" class="neighbors-message"></div>
                        </div>

                        <button data-bind="ltext: 'neighbors.status-dialog.ok'" data-test-id="neighbor-status-ok" class="btn btn-primary btn-dialog close"></button>

                    </div>
                </div>
            </div>

        </section>

        <div style="display:none;">
            <div id="dialog-company-user-op" class="window autosized">
                <div class="dialog-header">
                    <p data-bind="text: title"></p>
                    <p class="dialog-close close lupicon-remove"></p>
                </div>
                <div class="dialog-content">

                    <div>
                        <span data-bind="html: message"></span>
                    </div>

                    <div data-bind="visible: pending">
                        <em class="button-loader" style="position: relative;"></em>
                        <span data-bind="ltext: 'company.user.op.pending'"></span>
                    </div>

                    <button data-bind="click: ok,
                                       enable: !pending(),
                                       ltext: 'yes'"
                            class="positive btn-dialog"
                            data-test-id="dialog-company-user-op.ok">
                    </button>
                    <button data-bind="enable: !pending(),
                                       ltext: 'no'"
                            class="secondary btn-dialog close">
                    </button>

                </div>
            </div>
        </div>


    </body>
</html>
